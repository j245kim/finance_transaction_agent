{% extends "base.html" %} {% block content %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Financial Advisor | Home</title>
    <!-- Page Title -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/homer.css' %}" />
    <!-- Change required:href -->
    <!-- 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <!-- 폰트 끝 -->
    <!-- <script src="script.js"></script> -->
  </head>
  <body>
    <div class="container">
      <!-- 복사 여기서부터 -->
      <nav class="sidebar"> <!-- 왼쪽 sidebar -->
        <!-- Logo용 Font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Michroma&family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
        <!-- Logo용 Font 끝 -->
        <!-- sidebar style -->
        <style> /* 이 sidebar style 부분을 이식해야 제대로 동작할 수도 있음 */
          .nav-title {
              font-size : 18px;
              margin-bottom: 10px;
              color: #222222;
              align-items: center;
          }
          /* 여기서부터 */
          .sidebar ul {
              list-style: none;
              padding: 0;
              align-items: center;
          }
          .sidebar ul {
              margin-bottom: 10px;
              align-items: center; 
          }
          .sidebar ul li a {
              text-decoration: none;
              font-size: 16px;
              padding: 8px;
              border-radius: 5px;
              color: #444444;
              align-content: center;
          }
          /* 여기까지는 지울 수도 있음 */
          .sidebar {
              display: flex;
              flex-direction: column;
              align-items: left; /* 정렬 바꿀 때 이거 바꾸기 */
              height: 100vh;
              width: 200px; /* 적절한 너비 */
              padding: 20px 10px;
              position: fixed;
              left: 0;
              top: 0;
              background-color: #f7f7f5;
              box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
          }
          /* 메뉴 제목 */
          .nav-title {
              font-size: 18px;
              margin: 15px 0;
              color: #222;
              align-content: left;
          }
          /* 메뉴 리스트 */
          .sidebar-menu {
              list-style: none;
              padding: 0;
              width: 100%;
          }
          .sidebar-menu li {
              margin-bottom: 10px;
          }
          /* 버튼 스타일 */
          .sidebar-button {
              display: flex;
              align-items: center;
              justify-content: center;
              width: 100%;
              padding: 10px;
              text-decoration: none;
              border-radius: 5px;
              background-color: transparent;
              transition: background 0.3s ease;
          }
          
          .sidebar-button img {
              width: 36px;
              height: 36px;
              margin-right: 8px;
          }
          
          .sidebar-button span {
              font-size: 20px;
              color: #444444;
          }
          
          /* 호버 효과 */
          .sidebar-button:hover {
              background-color: #b6b6b6;
          }
        </style>
        <!-- sidebar style 끝-->
        <button
                class = "logo"
                href="{% url 'base:home' %}"
                style = "border : none; background-color : transparent; border-color : none; position : top; font-weight : bold; font-size : 18px;">
            <span style = "font-family: Michroma; font-size: 40px;">STFO</span>
            Financial Advisor
        </button> <!-- Logo Button -->
        <br/>
        <h2 class = "nav-title">분석</h2>
        <ul class = "sidebar-menu">
            <li>
            <a href="https://www.naver.com" class="sidebar-button" style = "position : middle;"> <!-- 진우! 여기 이미지 바꿔야함! --> <!-- 진우! 여기 href 바꿔야함! -->
              <img src="{% static 'home_image/sidebar_information.png' %}" alt="정보">
              <p>투자성향</p>
            </a>
          </li>
          <li>
            <a href="https://www.naver.com" class="sidebar-button">
              <img src="{% static 'home_image/sidebar_function.png' %}" alt="설명"> <!-- 진우! 여기 이미지 바꿔야함! --> <!-- 진우! 여기 href 바꿔야함! -->
              <p>통계</p> <!-- 솔직히 통계부분은 할 지 몰겠음 -->
            </a>
          </li>
        </ul> <!-- Sidebar 첫번째 section 끝 --> <!-- 이거 section 으로 감쌀까? -->
        <h2 class = "nav-title">기능</h2>
        <ul class = "sidebar-menu">
            <li>
            <a href="{ % url 'base:manual' %}" class="sidebar-button" style = "position : middle;">
              <img src="{% static 'home_image/sidebar_information.png' %}" alt="정보">
              <p>정보</p>
            </a>
          </li>
          <li>
            <a href="https://www.naver.com" class="sidebar-button">
              <img src="{% static 'home_image/sidebar_function.png' %}" alt="설명">
              <p>설명</p>
            </a>
          </li>
        </ul> <!-- Sidebar 첫번째 section 끝 -->
        <h2 class="nav-title">설정</h2>
    </nav> <!-- 왼쪽 sidebar 끝 -->
    <!-- 복사 여기까지 -->
      <!-- 메인 컨텐츠 영역 -->
      <main class="content">
        <div class = "intro">
          <h1>
            Finance Investment Agent
          </h1>
          <p class="sub-text">
            문서, 이미지, 웹사이트 분석과 최고의 성능
          </p>
        </div>
        <!-- 챗봇 영역 (추후 구현 예정) -->
        <section class="chatbot">
          <div class="chatbox">
            <div class="dropdown-container">
                </button>
                <button onclick="selectModel('ChatGPT')" data-model="ChatGPT">
                </button>
              </div>
            </div>
            <div class="chat-area">
              <div class="messages" id="messages"></div>
            </div>
            <div class="input-container">
              <input
                type="text"
                id="userInput"
                placeholder="질문을 입력하세요..."
              />
              <img id = "send-button" src="{% static 'home_image/arrow.png' %}" onclick="sendMessage()" style="cursor: pointer;">
            </div>
          </div>
          <!-- ChatBot Script -->
          <script>
           // Function to send the message
           let pushed = true; // Variable to ensure the margin is only adjusted once
// Function to send the message
async function sendMessage() {
  const inputField = document.getElementById("userInput");
  const messagesDiv = document.getElementById("messages");
  const userMessage = inputField.value.trim();
  // Don't send empty messages
  if (!userMessage) return;
  // Remove the intro section if it exists
  const introElement = document.querySelector(".intro");
  if (introElement) {
    introElement.remove();
  }
    // Move the input field down only once
    if (pushed) {
    inputField.style.marginTop = "40%";  // Adjust margin top to 60% of the page height
    pushed = false;  // Prevent further adjustment
  }
  // Display user message (left aligned, no background)
  const userMessageDiv = document.createElement("div");
  userMessageDiv.className = "message user";
  userMessageDiv.innerHTML = `<div class="message-content">${userMessage}</div>`;
  messagesDiv.appendChild(userMessageDiv);
  inputField.style.position = "relative";
  inputField.style.bottom = "200px";
  // Clear the input field
  inputField.value = "";
  // Display AI message (initially "봉주르" as placeholder response)
  const aiMessageDiv = document.createElement("div");
  aiMessageDiv.className = "message ai";
  const aiMessageContent = document.createElement("div");
  aiMessageContent.className = "message-content";
  aiMessageContent.textContent = "봉주르";  // Placeholder text for AI response
  aiMessageDiv.appendChild(aiMessageContent);
  messagesDiv.appendChild(aiMessageDiv);
  // Scroll to the latest message
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  try {
    // Assuming you're calling an API to get the AI response
    let apiEndpoint = "http://127.0.0.1:8001/chatgpt/"; // Adjust to your endpoint
    // Send user message to the API and get the AI's response
    const response = await fetch(`${apiEndpoint}${encodeURIComponent(userMessage)}`);
    const data = await response.json();
    // Update the AI's message with the response and format it
    aiMessageContent.innerHTML = `<hr><p>답변: ${data.content}</p>`; // Adding a line break and formatting the response
  } catch (error) {
    console.error("Error fetching AI response:", error);
    aiMessageContent.textContent = "Error fetching response.";  // In case of error
  }
  // After sending the message, ensure that the input field is always visible
  inputField.scrollIntoView({ behavior: 'smooth' });
}
// Listen for the 'Enter' key to send a message
const inputField = document.getElementById("userInput");
inputField.addEventListener("keyup", (event) => {
  if (event.key === "Enter") {
    sendMessage();
  }
});
            </script>
        </section>
      </main>
    </div>
  </body>
</html>
{% endblock content %}